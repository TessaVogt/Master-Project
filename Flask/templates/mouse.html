<!DOCTYPE html>
<html>
<head>
    <title>Mauszeichnung</title>
</head>
<style>
    .button_lo1{
        position: relative;
        top: 30px;
        left: 80px;
    }
    .button_lo2{
        position: relative;
        top: 100px;
        left: 80px;
    }
    .output_lo{
        position: relative;
        top: 80px;
        left: 80px;
    }
    .canvas_lo{
        position: relative;
        left: 80px;
        top: 60px;
        /* Füge hier das Hintergrundbild ein */
        background-image: url('canvas_background.png');
        /* Optional: Passe die Größe und Wiederholung des Hintergrundbilds an */
        background-size: contain;
        background-repeat: no-repeat;
    }
    .nav_lo{
        font-size: 20px;
    }
</style>
<body>
    <nav class="navbar bg-body-tertiary nav_lo">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">Font Creater</a>
        </div>
    </nav>

    <form class="input-group mb-3 button_lo1" method="POST">
        <input type="text" id="font-name-input" class="form-control" placeholder="Font Name" aria-label="Font Name" aria-describedby="button-addon2">
        <input type="text" id="letter-input" class="letter-input" placeholder="Letter" data-points="[]" aria-describedby="button-addon2">
        <button class="btn btn-outline-secondary" type="button" id="button-addon2" onclick="saveCoordinates()">Save</button>
        <button class="btn btn-outline-secondary" type="button" id="button-addon2" onclick="eraseCanvas()">Erase</button>
    </form>
    
    <div class="canvas-container canvas_lo">
        <h5>Schreibe hier in dieses Feld mit der Maus den Buchstaben hinein</h5>
        <canvas id="canvas" width="500" height="290" style="border: 1px solid black;"></canvas>
    </div>

    <!-- Display the tracked letters in a text field -->
    <div class="mb-3 output_lo">
        <h5>Bereits hinzugefügte Buchstaben</h5>
        <textarea id="tracked-letters" class="form-control" rows="10" readonly></textarea>
    </div>
    
    

<script>
    let canvas = document.getElementById('canvas');
    let ctx = canvas.getContext('2d');
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;
    let points = [];

    canvas.addEventListener('mousedown', (e) => {
        isDrawing = true;
        lastX = e.offsetX;
        lastY = e.offsetY;
        points.push({ x: lastX, y: lastY, isNewLine: true }); // isNewLine für den Punkt setzen
    });

    canvas.addEventListener('mousemove', (e) => {
        if (!isDrawing) return;

        drawLetter(e.offsetX, e.offsetY);
        lastX = e.offsetX;
        lastY = e.offsetY;
        points.push({ x: lastX, y: lastY, isNewLine: false }); // isNewLine für den Punkt setzen
        });

    canvas.addEventListener('mouseup', () => {
        isDrawing = false;
    });

    function drawLetter(x, y) {
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(x, y);
        ctx.stroke();
    }

    function saveCoordinates() {
        let letterInput = document.querySelector('.letter-input');
        let letter = letterInput.value;

        // Lese den Tabellennamen aus dem Eingabefeld aus
        fontNameInput = document.getElementById('font-name-input');
        let fontName = fontNameInput.value;

        console.log(fontName); // Überprüfe, ob der Tabellenname korrekt ist
        console.log(letter); // Überprüfe, ob der Buchstabe korrekt ist
        console.log(points); // Überprüfe, ob die Koordinaten korrekt sind

        let newLine = isDrawing;

        fetch('/save', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ font_name: fontName, letter: letter, points: points, new_line: newLine })
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
            // Nachdem die Daten gespeichert wurden, rufe fetchTrackedLetters auf
            fetchTrackedLetters();
        })
        .catch(error => console.error('Error saving coordinates:', error));


        // Zurücksetzen der Punkte nach dem Speichern
        points = [];
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function eraseCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // Zurücksetzen der Punkte ohne den Buchstaben zu speichern
        points = [];
    }

    function fetchTrackedLetters() {
        let fontNameInput = document.getElementById('font-name-input').value;
        fetch(`/tracked_letters?font_name=${fontNameInput}`)
            .then(response => response.json())
            .then(data => {
                let trackedLettersInput = document.getElementById('tracked-letters');
                trackedLettersInput.value = data.join(', ');
            })
            .catch(error => console.error('Error fetching tracked letters:', error));
    }

    // Rufe die Funktion einmal auf, um die Buchstaben beim Laden der Seite anzuzeigen
    // updateTrackedLetters();
</script>
</body>
</html>
